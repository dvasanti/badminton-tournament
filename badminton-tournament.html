<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Badminton Tournament - SS ralley</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h2, h3 { text-align: center; color: #333; }

    /* Tabs */
    .tab {
        overflow: hidden;
        border-bottom: 2px solid #ccc;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
    }
    .tab button {
        background-color: inherit;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 10px 20px;
        transition: 0.3s;
        font-size: 16px;
    }
    .tab button:hover { background-color: #ddd; }
    .tab button.active {
        background-color: #4CAF50;
        color: white;
        font-weight: bold;
    }

    .tabcontent {
        display: none;
        animation: fadeEffect 0.5s;
    }
    @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

    .bracket {
        display: flex;
        justify-content: center;
        gap: 60px;
        margin-top: 20px;
        overflow-x: auto;
    }

    .round {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        gap: 20px;
    }

    .match {
        background: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        text-align: center;
        min-width: 150px;
    }

    .winner-btn {
        display: block;
        margin: 5px auto;
        padding: 4px 8px;
        cursor: pointer;
    }

    .winner { color: green; font-weight: bold; }

    .champion {
        text-align: center;
        margin-top: 20px;
        font-size: 1.2em;
        font-weight: bold;
        color: green;
    }

    label { display:block; margin-top:10px; }
    input { width: 100%; padding:5px; margin-top: 5px; }
    #exportBtn { display:block; margin:30px auto; padding:10px 20px; background:green; color:white; cursor:pointer; border:none; border-radius:5px; }
</style>
</head>
<body>

<h2>üè∏ Multi-Category Badminton Tournament (Ultimate Version)</h2>

<div id="categories"></div>

<button onclick="generateAllCategories()">Generate All Brackets</button>

<hr>

<!-- Tabs -->
<div class="tab" id="categoryTabs"></div>
<div id="tournaments"></div>

<button id="exportBtn" onclick="exportWinnersToExcel()" style="display:none;">Export Winners to Excel</button>

<!-- SheetJS for Excel export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
const categoryList = [
   "Boys Under 9",
    "Boys Under 11",
    "Boys Under 13",
    "Boys Under 15",
    "Boys Under 19",
    "Girls Under 9",
    "Girls Under 11",
    "Girls Under 13",
    "Girls Under 15",
    "Girls Under 19"
];

let categoryChampions = {}; 

// Create input fields for categories
const catDiv = document.getElementById('categories');
categoryList.forEach(cat => {
    const div = document.createElement('div');
    div.className = 'category';
    div.innerHTML = `
        <h3>${cat}</h3>
        <label>Enter Player Names (comma separated):</label>
        <input type="text" id="${cat.replace(/\s/g,'_')}" placeholder="Ex: Player1, Player2, ...">
    `;
    catDiv.appendChild(div);
});

function generateAllCategories(){
    document.getElementById('tournaments').innerHTML = '';
    document.getElementById('categoryTabs').innerHTML = '';
    categoryChampions = {};
    document.getElementById('exportBtn').style.display = 'none';

    let firstTab = true;

    categoryList.forEach((cat, idx) => {
        const playersInput = document.getElementById(cat.replace(/\s/g,'_')).value;
        let players = playersInput.split(',').map(p => p.trim()).filter(p=>p);

        if(players.length < 2) return; 

        const tabId = cat.replace(/\s/g,'_');

        // Create Tab Button
        const tabBtn = document.createElement('button');
        tabBtn.textContent = cat;
        tabBtn.dataset.target = tabId+"_content";
        tabBtn.onclick = () => openCategory(tabBtn);
        if(firstTab){ tabBtn.classList.add('active'); firstTab = false; }
        document.getElementById('categoryTabs').appendChild(tabBtn);

        // Create Tab Content
        const container = document.createElement('div');
        container.id = tabId+"_content";
        container.className = 'tabcontent';
        container.style.display = (idx===0) ? 'block' : 'none';
        container.innerHTML = `<h3>${cat} Bracket</h3>
                               <div class="bracket" id="${tabId}_bracket"></div>
                               <div class="champion" id="${tabId}_champion"></div>`;
        document.getElementById('tournaments').appendChild(container);

        startTournament(players, tabId);
    });
}

function openCategory(button){
    document.querySelectorAll('.tabcontent').forEach(tc => tc.style.display='none');
    document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(button.dataset.target).style.display='block';
    button.classList.add('active');
}

function startTournament(players, catId){
    const bracketDiv = document.getElementById(catId+"_bracket");
    bracketDiv.innerHTML = '';

    // calculate next power of 2
    let size = 1;
    while(size < players.length) size *= 2;
    while(players.length < size) players.push("Bye");

    let rounds = Math.log2(players.length);
    bracketDiv.winners = {};

    for(let r=0; r<rounds; r++){
        const roundDiv = document.createElement('div');
        roundDiv.className = 'round';
        roundDiv.dataset.round = r;
        bracketDiv.appendChild(roundDiv);
    }

    fillRound(players, 0, catId);
}

function fillRound(players, roundIndex, catId){
    const bracketDiv = document.getElementById(catId+"_bracket");
    const roundDiv = bracketDiv.querySelectorAll('.round')[roundIndex];
    roundDiv.innerHTML = '';
    bracketDiv.winners[roundIndex] = [];

    players.forEach((_, i) => {
        if(i % 2 !== 0) return;
        const p1 = players[i];
        const p2 = players[i+1] || "Bye";

        const matchDiv = document.createElement('div');
        matchDiv.className = 'match';

        if(p1==="Bye" && p2==="Bye"){
            // Skip completely, don't create dead matches
            return;
        }
        else if(p1==="Bye" || p2==="Bye"){
            const winner = (p1==="Bye") ? p2 : p1;
            matchDiv.innerHTML = `<span class="winner">${winner}</span> (Bye)`;
            bracketDiv.winners[roundIndex].push(winner);
        }
        else {
            matchDiv.innerHTML = `
                ${p1} vs ${p2}<br>
                <button class="winner-btn" onclick="declareWinner('${p1}','${p2}',${roundIndex}, this,'${catId}')">${p1} Wins</button>
                <button class="winner-btn" onclick="declareWinner('${p2}','${p1}',${roundIndex}, this,'${catId}')">${p2} Wins</button>
            `;
        }
        roundDiv.appendChild(matchDiv);
    });

    autoAdvance(catId, roundIndex);
}

function declareWinner(winner, loser, roundIndex, btn, catId){
    const matchDiv = btn.parentElement;
    matchDiv.innerHTML = `<span class="winner">${winner}</span> defeated ${loser}`;

    const bracketDiv = document.getElementById(catId+"_bracket");
    bracketDiv.winners[roundIndex].push(winner);

    autoAdvance(catId, roundIndex);
}

function autoAdvance(catId, roundIndex){
    const bracketDiv = document.getElementById(catId+"_bracket");
    const roundDiv = bracketDiv.querySelectorAll('.round')[roundIndex];
    const matchesInRound = Array.from(roundDiv.querySelectorAll('.match')).length;

    // If no matches left to play in this round
    if(bracketDiv.winners[roundIndex].length === matchesInRound){
        const nextRoundPlayers = bracketDiv.winners[roundIndex];
        if(nextRoundPlayers.length === 1){
            document.getElementById(catId+"_champion").innerHTML = `üèÜ Champion: ${nextRoundPlayers[0]} üèÜ`;
            categoryChampions[catId] = nextRoundPlayers[0];
            document.getElementById('exportBtn').style.display = 'block';
        } else {
            fillRound(nextRoundPlayers, roundIndex+1, catId);
        }
    }
}

// Export winners to Excel
function exportWinnersToExcel(){
    const data = [["Category", "Champion"]];
    for(const cat of categoryList){
        const key = cat.replace(/\s/g,'_');
        const winner = categoryChampions[key] || "Not Completed";
        data.push([cat, winner]);
    }

    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Winners");

    XLSX.writeFile(wb, "Tournament_Winners.xlsx");
}
</script>
@ by VD WebSolutions
</body>
</html>
